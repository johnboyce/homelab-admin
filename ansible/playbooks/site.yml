---
# Full homelab convergence playbook
# Run all roles in order
- name: Converge homelab-admin infrastructure
  hosts: geek
  gather_facts: yes
  pre_tasks:
    - name: Sync homelab-admin repo on geek
      ansible.builtin.git:
        repo: https://github.com/johnboyce/homelab-admin.git
        dest: /home/johnb/homelab-admin
        version: main
        update: yes
        force: no
      become: no
      tags: always
  roles:
    - role: firewall
      tags: [firewall, bootstrap, config]
    - role: nginx
      tags: [nginx, config]
    - role: docker_infra
      tags: [docker, bootstrap]
    - role: landing
      tags: [landing, lifecycle]
    - role: postgres
      tags: [postgres, lifecycle]
    - role: plane
      tags: [plane, lifecycle]
    - role: authentik
      tags: [authentik, lifecycle]
    - role: cloudflare_ddns
      tags: [cloudflare-ddns, lifecycle]
    - role: pihole
      tags: [pihole, lifecycle]
    - role: bookstack
      tags: [bookstack, lifecycle]
    - role: forgejo
      tags: [forgejo, lifecycle]
    - role: woodpecker
      tags: [woodpecker, lifecycle]
