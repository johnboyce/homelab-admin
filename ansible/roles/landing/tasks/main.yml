---
- name: Deploy landing page via docker-compose
  community.docker.docker_compose_v2:
    project_src: /home/johnb/homelab-admin/platform/landing
    state: present
  become: yes
  register: landing_result

- name: Flush handlers before health check (ensures nginx is reloaded)
  meta: flush_handlers

- name: Wait for landing page to be ready
  uri:
    url: http://localhost/healthz
    headers:
      Host: geek
    status_code: [200]
  retries: 10
  delay: 2
  register: result
  until: result.status == 200
  become: no
  ignore_errors: yes
