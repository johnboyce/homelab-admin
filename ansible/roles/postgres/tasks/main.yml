---
# PostgreSQL Service Management Role
# Manages PostgreSQL container and backup scheduling
# Phase 5: Lifecycle management (current: stub)

- name: Check PostgreSQL compose file exists
  stat:
    path: /home/johnb/homelab-admin/platform/postgres/docker-compose.yml
  register: postgres_compose
  tags: [postgres, lifecycle]

- name: Report PostgreSQL status
  debug:
    msg: |
      PostgreSQL Status:
      - Compose file: {{ 'exists' if postgres_compose.stat.exists else 'missing' }}
      - Service: Managed by Ansible (state: present, auto-pull enabled)
  when: postgres_compose.stat.exists
  tags: [postgres, lifecycle]

- name: Ensure PostgreSQL service is running
  community.docker.docker_compose_v2:
    project_src: /home/johnb/homelab-admin/platform/postgres
    state: present
    pull: policy
  become: yes
  tags: [postgres, lifecycle]
