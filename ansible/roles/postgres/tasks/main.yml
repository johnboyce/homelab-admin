---
# PostgreSQL Service Management Role
# Manages PostgreSQL container and backup scheduling
# Phase 5: Lifecycle management (current: stub)

- name: Check PostgreSQL compose file exists
  stat:
    path: /opt/platform/postgres/docker-compose.yml
  register: postgres_compose
  tags: [postgres, lifecycle]

- name: Verify PostgreSQL environment file
  stat:
    path: /opt/platform/postgres/.env
  register: postgres_env
  when: postgres_compose.stat.exists
  tags: [postgres, lifecycle]

- name: Report PostgreSQL status
  debug:
    msg: |
      PostgreSQL Status:
      - Compose file: {{ 'exists' if postgres_compose.stat.exists else 'missing' }}
      - Environment file: {{ 'exists' if postgres_env.stat.exists else 'missing' }}

      (Phase 5: Postgres container management not yet automated)
      To enable: uncomment community.docker.docker_compose_v2 task below
  tags: [postgres, lifecycle]

# TODO: Phase 5 - Uncomment when ready to automate service lifecycle
# - name: Ensure PostgreSQL service is running
#   community.docker.docker_compose_v2:
#     project_src: /opt/platform/postgres
#     state: present
#     pull: policy
#   become: yes
#   tags: [postgres, lifecycle]
